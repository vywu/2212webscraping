import timeit
import mechanize
import time
from bs4 import BeautifulSoup
start=timeit.default_timer()
URL='http://studentservices.uwo.ca/secure/timetables/mastertt/ttindex.cfm'
br=mechanize.Browser()
br.open(URL)
br.select_form(nr=0)
control=br.find_control("subject")
subjectlist=[]
for item in control.items:
    cur=[]
    if item.name!='':
        cur.append(item.name)
        subjectlist.append(cur)

print "Total number of courses:"
print len(subjectlist)

# br=mechanize.Browser()
# br.open(URL)
for i in range(len(subjectlist)):
    br.select_form(nr=0)
    br.form["subject"]=subjectlist[i]
    response = br.submit()
    page=response.read().decode('utf-8','ignore')
    soup=BeautifulSoup(page,'html.parser')
    courselist=soup.find_all(class_="table table-striped")
    for j in range(len(courselist)):
        subsoup=BeautifulSoup(str(courselist[j]),'html.parser')
        coursename=subsoup.find("h4")
        coursename=coursename.get_text()
        print coursename
        tbody=subsoup.find("tbody")
        content=tbody.contents[1]
        objects=content.contents
        for k in range(1,len(objects)-4,2):
            c=objects[k].get_text()
            info=' '.join(c.split())
            print info
        print "*****************************************************"
    if ((i+1)%5==0):#stop for 60 seconds every five subjects to avoid the   activation of captcha
        time.sleep(60)
stop=timeit.default_timer()
print stop-start #calculate the runtime


